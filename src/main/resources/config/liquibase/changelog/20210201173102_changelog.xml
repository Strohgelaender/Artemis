<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd">
    <changeSet author="philippbauch" id="20210201173114">
        <createTable tableName="plagiarism_result">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                    primaryKeyName="plagiarism_resultPK"/>
            </column>
            <column name="discriminator" type="VARCHAR(31)">
                <constraints nullable="false"/>
            </column>
            <column name="duration" type="BIGINT"/>
            <column name="exercise_id" type="BIGINT"/>
            <column name="created_by" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column defaultValueComputed="CURRENT_TIMESTAMP" name="created_date" type="TIMESTAMP">
                <constraints nullable="false"/>
            </column>
            <column name="last_modified_by" type="VARCHAR(50)"/>
            <column name="last_modified_date" type="TIMESTAMP"/>
        </createTable>
        <createTable tableName="plagiarism_result_similarity_distribution">
            <column name="plagiarism_result_id" type="BIGINT"/>
            <column name="value" type="INT"/>
        </createTable>
        <createTable tableName="plagiarism_comparison">
            <column autoIncrement="true" name="id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                    primaryKeyName="plagiarism_comparisonPK"/>
            </column>
            <column name="plagiarism_result_id" type="BIGINT"/>
            <column name="similarity" type="FLOAT"/>
            <column name="status" type="INT"/>
        </createTable>
        <createTable tableName="plagiarism_submission">
            <column name="submission_id" type="BIGINT">
                <constraints nullable="false" primaryKey="true"
                    primaryKeyName="plagiarism_submissionPK"/>
            </column>
            <column name="student_login" type="VARCHAR(50)"/>
            <column name="size" type="INT"/>
            <column name="score" type="INT"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="exercise_id" baseTableName="plagiarism_result"
            constraintName="fk_plagiarism_result_exercise" deferrable="false"
            initiallyDeferred="false" referencedColumnNames="id" referencedTableName="exercise"/>
        <addForeignKeyConstraint baseColumnNames="plagiarism_result_id"
            baseTableName="plagiarism_result_similarity_distribution"
            constraintName="fk_plagiarism_result_similarity_distribution" deferrable="false"
            initiallyDeferred="false" referencedColumnNames="id"
            referencedTableName="plagiarism_result"/>
        <addForeignKeyConstraint baseColumnNames="plagiarism_result_id"
            baseTableName="plagiarism_comparison"
            constraintName="fk_plagiarism_result_comparison" deferrable="false"
            initiallyDeferred="false" referencedColumnNames="id"
            referencedTableName="plagiarism_result"/>
        <addForeignKeyConstraint baseColumnNames="submission_id"
            baseTableName="plagiarism_submission"
            constraintName="fk_submission_plagiarism_submission" deferrable="false"
            initiallyDeferred="false" referencedColumnNames="id"
            referencedTableName="submission"/>
    </changeSet>
</databaseChangeLog>
